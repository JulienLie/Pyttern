import{R as o,r as S,j as e}from"./index-Da4_xnN5.js";const T=({code:m,pattern:h,setState:p})=>{const[n,u]=o.useState(!1),[s,a]=o.useState(0),[g,j]=o.useState(!1),[d,x]=o.useState(0),[v,C]=o.useState([]),f=o.useRef(null),b=o.useRef(null);S.useEffect(()=>{j(m!==""&&h!==""),a(0)},[m,h]);const k=()=>(console.log("Start match"),fetch("/api/match",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:m,pattern:h})}).then(t=>{if(!t.ok)throw u(!1),new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(t=>{if(t.status==="error")throw u(!1),new Error(t.message);u(!0),x(t.n_steps),p({currentState:{patternNode:t.state[0],codeNode:t.state[1]},matchedNodes:[],prevMatchedNodes:[],currentStack:"",previousStack:"",codePos:[0,0]});const l=t.match_states,r=[];for(const c of l)r.push(e.jsx("option",{value:c},c));C(r)}),()=>{u(!1),x(0)});S.useEffect(()=>{console.log("Getting step",s),fetch("/api/step",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({step:s})}).then(t=>{if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(t=>{if(t.status==="error")throw new Error(t.message);f.current&&(f.current.value=""+s),b.current&&(b.current.value=""+s);const l=[];for(const i of t.current_matchings)l.push({patternNode:i[0],codeNode:i[1]});const r=[];for(const i of t.previous_matchings)r.push({patternNode:i[0],codeNode:i[1]});const c=t.code_pos;c[1]+=1,p({currentState:{patternNode:t.state[0],codeNode:t.state[1]},matchedNodes:l,prevMatchedNodes:r,currentStack:t.current_stack,previousStack:t.previous_stack,codePos:c}),console.log("Code pos",c)})},[p,s]);const y=()=>{s>0&&a(s-1)},w=()=>{s<d&&a(s+1)},N=t=>{const r=t.target.value;console.log("Changing step",r),a(parseInt(r))};return e.jsxs("div",{className:"row",children:[e.jsx("button",{className:"btn-primary btn ctrl col-1 mx-2",id:"first",disabled:!n,onClick:()=>a(0),children:"First"}),e.jsx("button",{className:"btn-primary btn ctrl col-1 mx-2",id:"prev",disabled:!n,onClick:y,children:"Prev"}),e.jsx("button",{className:"btn btn-primary ctrl col-1 mx-2",id:"start",disabled:!g,onClick:k,children:"Start"}),e.jsx("label",{className:"col-1 mx-2",children:e.jsx("input",{className:"form-control ctrl",type:"number",defaultValue:"0",id:"step",max:d,min:"0",disabled:!n,onChange:N,ref:f})}),e.jsxs("label",{className:"col-5 mx-2",children:[e.jsx("input",{className:"w-100 ctrl",type:"range",defaultValue:"0",id:"range",list:"matches",max:d,min:"0",disabled:!n,onChange:N,ref:b}),e.jsx("datalist",{id:"matches",children:v})]}),e.jsx("button",{className:"btn-primary btn ctrl col-1 mx-2",id:"next",disabled:!n,onClick:w,children:"Next"}),e.jsx("button",{className:"btn-primary btn ctrl col-1 mx-2",id:"last",disabled:!n,onClick:()=>a(d),children:"Last"})]})};export{T as default};
