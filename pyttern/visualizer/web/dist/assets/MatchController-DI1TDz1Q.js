import{R as a,r as N,j as e}from"./index-DRzjDA2I.js";const R=({code:m,pattern:d,setState:h,setMatchedNodes:g,setPrevMatchNode:S})=>{const[o,i]=a.useState(!1),[s,c]=a.useState(0),[j,y]=a.useState(!1),[u,b]=a.useState(0),[C,v]=a.useState([]),p=a.useRef(null),f=a.useRef(null);N.useEffect(()=>{y(m!==""&&d!=="")},[m,d]);const w=()=>(console.log("Start match"),fetch("/api/match",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:m,pattern:d})}).then(t=>{if(!t.ok)throw i(!1),new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(t=>{if(t.status==="error")throw i(!1),new Error(t.message);i(!0),b(t.n_steps),h({patternNode:t.state[0],codeNode:t.state[1]});const l=t.match_states,r=[];for(const n of l)r.push(e.jsx("option",{value:n},n));v(r)}),()=>{i(!1),b(0)});N.useEffect(()=>{console.log("Getting step",s),fetch("/api/step",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({step:s})}).then(t=>{if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(t=>{if(t.status==="error")throw new Error(t.message);p.current&&(p.current.value=""+s),f.current&&(f.current.value=""+s),h({patternNode:t.state[0],codeNode:t.state[1]});const l=[];for(const n of t.current_matchings)l.push({patternNode:n[0],codeNode:n[1]});g(l);const r=[];for(const n of t.previous_matchings)r.push({patternNode:n[0],codeNode:n[1]});S(r)})},[h,s]);const E=()=>{s>0&&c(s-1)},T=()=>{s<u&&c(s+1)},x=t=>{const r=t.target.value;console.log("Changing step",r),c(parseInt(r))};return e.jsxs("div",{className:"row",children:[e.jsx("button",{className:"btn-primary btn ctrl col-1 mx-2",id:"first",disabled:!o,onClick:()=>c(0),children:"First"}),e.jsx("button",{className:"btn-primary btn ctrl col-1 mx-2",id:"prev",disabled:!o,onClick:E,children:"Prev"}),e.jsx("button",{className:"btn btn-primary ctrl col-1 mx-2",id:"start",disabled:!j,onClick:w,children:"Start"}),e.jsx("label",{className:"col-1 mx-2",children:e.jsx("input",{className:"form-control ctrl",type:"number",defaultValue:"0",id:"step",max:u,min:"0",disabled:!o,onChange:x,ref:p})}),e.jsxs("label",{className:"col-5 mx-2",children:[e.jsx("input",{className:"w-100 ctrl",type:"range",defaultValue:"0",id:"range",list:"matches",max:u,min:"0",disabled:!o,onChange:x,ref:f}),e.jsx("datalist",{id:"matches",children:C})]}),e.jsx("button",{className:"btn-primary btn ctrl col-1 mx-2",id:"next",disabled:!o,onClick:T,children:"Next"}),e.jsx("button",{className:"btn-primary btn ctrl col-1 mx-2",id:"last",disabled:!o,onClick:()=>c(u),children:"Last"})]})};export{R as default};
