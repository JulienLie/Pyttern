import{r as a,j as o}from"./index-BctQ572d.js";/* empty css                  */import{R as $,p as O}from"./pytternSyntaxHighlighter-AkmHhPRq.js";import{g as y,C as N}from"./CytoscapeComponent.helper-CABiexUB.js";function W(){const[l,d]=a.useState([]),[h,x]=a.useState(""),[v,w]=a.useState([]),[m,g]=a.useState({}),[C,k]=a.useState([]),[i,p]=a.useState(""),_=a.useRef(null),b=a.useRef(null),j=a.useRef(null);a.useEffect(()=>{fetch("/api/loaded_macro",{method:"GET",headers:{"Content-Type":"application/json"}}).then(t=>{if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(t=>{if(t.status!=="ok")return;const e=[];for(let n of t.macros){const s=n;console.log(s);for(let f in s.transformations){console.log(s.transformations[f]);let r=s.transformations[f],u=y(N.GRAPH,r);s.transformations[f]=u}e.push(s)}d(e)})},[]);function E(t,e){fetch("/api/parse_macro",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})}).then(n=>{if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n.json()}).then(n=>{if(n.status!=="ok"){const r=l.find(u=>u.name===t);r&&(r.error=n.message);return}const s=n.macro;console.log(s);for(let r in s.transformations){console.log(s.transformations[r]);let u=s.transformations[r],H=y(N.GRAPH,u);s.transformations[r]=H}const f=l.map(r=>r.name===t?s:r);d(f),h==t&&R(s.name)})}function R(t){x(t),g({}),p("")}function T(){const t={name:"imported macro",code:"",transformations:{}};d([...l,t])}function S(){const t="Macro";let e=1,n=t+e;for(;l.some(r=>r.name==n);)e+=1,n=t+e;const s=`?# DEFINE
?${n}()

?# 1
# Add definition here`,f={name:n,code:s,transformations:{}};d([...l,f])}const c=l.find(t=>t.name===h),M=t=>{j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{c&&(c.code=t,E(c.name,t))},500)};a.useEffect(()=>{const t=[];for(let e of l){const s="list-group-item list-group-item-action "+(e.name==h?"active":"");t.push(o.jsxs("button",{type:"button",className:s,onClick:()=>x(e.name),children:[e.name," ",e.error?o.jsx("span",{children:"âš "}):""]},e.name))}w(t)},[l,h]),a.useEffect(()=>{if(!c)return;g(c.transformations);const t=[];let e="";for(let n in c==null?void 0:c.transformations)e||(e=n),t.push(o.jsx("option",{value:n,children:n}));k(t),p(e)},[c]),a.useEffect(()=>{if(!(!b.current||!_.current)){for(const t in m)m[t].unmount();return i&&(m[i].mount(_.current),m[i].fit()),()=>{i&&m[i].unmount()}}},[i]);function P(t){const e=t.target.value;p(e)}function A(){if(!i)return;const t=m[i].png(),e=document.createElement("a");e.href=t,e.download=`${i}.png`,e.click()}const G=()=>{i&&m[i].fit()};return o.jsxs("div",{className:"row h-100",children:[o.jsxs("div",{className:"col",children:[o.jsx("div",{className:"list-group",children:v}),o.jsxs("div",{className:"list-group m-2",children:[o.jsx("button",{type:"button",onClick:S,className:"btn btn-success m-1",children:"Add macro"},"add"),o.jsx("button",{type:"button",onClick:T,className:"btn btn-success m-1",children:"Import Macro"},"import")]})]}),o.jsxs("div",{className:"col h-100",children:[o.jsx("div",{className:"vstack container-fluid h-50",children:o.jsx($,{value:c==null?void 0:c.code,placeholder:"Write the macro here...",onChange:M,extensions:[O],height:"100%"})}),o.jsxs("div",{className:"vstack container-fluid h-50 border",children:[o.jsxs("div",{className:"input-group",children:[o.jsx("select",{className:"form-select",id:"select",ref:b,onChange:P,children:C}),o.jsx("button",{className:"btn btn-primary ms-auto",onClick:G,children:"Reset"}),o.jsx("button",{className:"btn btn-primary",onClick:A,children:"Download"})]}),o.jsx("div",{id:"macro_repr",ref:_,className:"p-2 h-100"})]})]})]})}export{W as default};
