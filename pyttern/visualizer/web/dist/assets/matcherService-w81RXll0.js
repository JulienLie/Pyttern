import{e as i,f as d,h as p,b as u,c as l,i as h,k as f,l as m,m as w,n as g,o as y,p as S,q as T}from"./index-D7V7G12u.js";async function N(r,a){const t=await fetch("/api/match",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:r,pattern:a})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();if(e.status==="error")throw new Error(e.message);return e}async function k(r){const a=await fetch("/api/step",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({step:r})});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const t=await a.json();if(t.status==="error")throw new Error(t.message);return t}async function E(r,a){const t=await fetch("/api/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:r,lang:a})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}async function P(r,a){const t=await fetch(`/api/${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:r})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();if(e.status==="error")throw new Error(e.message);return e}const C=i("matcher/startMatch",async(r,{dispatch:a,getState:t})=>{const{matcher:e}=t(),{code:n,patternCode:o}=e;a(y());try{const s=await N(n,o),c={currentState:{patternNode:s.state[0],codeNode:s.state[1]},matchedNodes:[],prevMatchedNodes:[],currentStack:"",previousStack:"",codePos:[0,0]};a(S({maxSteps:s.n_steps,matchStates:s.match_states,initialState:c}))}catch(s){const c=s instanceof Error?s.message:"Unknown error occurred";throw a(T(c)),s}}),$=i("matcher/fetchStepData",async(r,{dispatch:a})=>{try{const t=await k(r),e=t.current_matchings.map(c=>({patternNode:c[0],codeNode:c[1]})),n=t.previous_matchings.map(c=>({patternNode:c[0],codeNode:c[1]})),o=[t.code_pos[0],t.code_pos[1]+1],s={currentState:{patternNode:t.state[0],codeNode:t.state[1]},matchedNodes:e,prevMatchedNodes:n,currentStack:t.current_stack,previousStack:t.previous_stack,codePos:o};a(g(s))}catch(t){throw console.error("Error fetching step data:",t),t}}),j=i("matcher/validateCode",async({code:r,lang:a,type:t},{dispatch:e})=>{e(d(!0));try{const n=await E(r,a);if(n.status==="ok")e(p(t)),e(t==="pattern"?u(r):l(r));else{const o=n.message;let s;typeof o=="string"?s=o:o&&typeof o=="object"?s=`Error at line ${o.line}:${o.column} - ${o.msg}`:s="Validation failed",e(h({type:t,error:s}))}}catch(n){const o=n instanceof Error?n.message:"Validation failed";e(h({type:t,error:o}))}finally{e(d(!1))}}),_=i("matcher/fetchGraphData",async({code:r,type:a},{dispatch:t})=>{t(f(!0));try{const n=(await P(r,a)).graph;t(a==="pattern"?m(n):w(n))}catch(e){throw console.error(`Error fetching ${a} graph data:`,e),e}finally{t(f(!1))}});export{_ as a,$ as f,C as s,j as v};
