var S=Object.defineProperty;var T=(s,t,e)=>t in s?S(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var x=(s,t,e)=>T(s,typeof t!="symbol"?t+"":t,e);import{r as l,j as n}from"./index-BctQ572d.js";/* empty css                  */import{V as D,a as F,D as M,C as P,R as $,p as k}from"./pytternSyntaxHighlighter-AkmHhPRq.js";function j(s,t){return D.fromClass(class{constructor(e){x(this,"decorations");this.decorations=this.buildDecorations(e)}update(e){(e.docChanged||e.viewportChanged)&&(this.decorations=this.buildDecorations(e.view))}buildDecorations(e){const o=new F,d=e.state.doc,u=d.length,c=Math.max(0,Math.min(s,u));let i=Math.max(0,Math.min(t,u));for(;i>c&&/\s/.test(d.slice(i-1,i).toString());)i--;return c<i&&o.add(c,i,M.mark({class:"cm-highlight-range"})),o.finish()}},{decorations:e=>e.decorations})}const b=new P,A=({name:s,onCodeChange:t,pos:e})=>{const[o,d]=l.useState(""),[u,c]=l.useState(""),[i,w]=l.useState(""),h=l.useRef(null),f=l.useRef(null);l.useEffect(()=>{o!==""&&fetch("/api/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:o,lang:i})}).then(r=>{if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return r.json()}).then(r=>{if(r.status==="ok"){c(""),t&&t(o);return}const a=r.message;if(typeof a=="string"){c(a);return}else c(`Error at line ${a.line}:${a.column} - ${a.msg}`)})},[o,t,i]);const y=r=>{h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{d(r)},500)},C=r=>{var g;const a=(g=r.target.files)==null?void 0:g[0];if(a){const v=a.name.split(".").pop()||"";w(v);const m=new FileReader;m.onload=E=>{var p;const N=(p=E.target)==null?void 0:p.result;d(N)},m.onerror=()=>{alert("Failed to read the file. Please try again.")},m.readAsText(a)}};l.useEffect(()=>{f.current&&f.current.dispatch({effects:b.reconfigure(j(e[0],e[1]))})},[e]),console.log(e);const R=!o;return n.jsxs("div",{className:"form-floating",children:[n.jsx("form",{className:"row mb-3",children:n.jsx("div",{className:"col-auto",children:n.jsx("input",{type:"file",className:"form-control",accept:".py,.pyt,.pyh,.java,.jat",name:"file",id:"file",onChange:C,required:!0})})}),n.jsxs("div",{className:"row m-1",children:[n.jsx("p",{style:{color:"red"},children:u}),n.jsx("label",{htmlFor:s,style:{height:"fit-content"},children:s}),n.jsx($,{value:o,onChange:y,placeholder:s,extensions:[k,b.of(j(e[0],e[1]))],onCreateEditor:r=>{f.current=r}})]}),n.jsx("form",{className:"row p-4 mw-25",onSubmit:()=>d(""),children:n.jsx("input",{type:"submit",value:"Clear",className:"btn btn-danger",disabled:R})})]})};export{A as default};
