import{r,j as u}from"./index-BctQ572d.js";/* empty css                  */import{C as R,g}from"./CytoscapeComponent.helper-CABiexUB.js";const S=({name:l,code:i,grid:n,state:f})=>{const b="follow_"+l,v=l+"-cy",a=r.useRef(null),[s,w]=r.useState([]),[x,E]=r.useState([]),d=r.useRef(null),p=r.useRef(null),h=r.useRef(null);n==null||n.on("change",function(o,t){t.forEach(e=>{e.el&&y(e.el)})});function y(o){if(o.contains(d.current)){const t=a.current,e=p.current;if(t&&e&&o){const c=o.getBoundingClientRect(),C=e.getBoundingClientRect().height+25;t.style.width=c.width-20+"px",t.style.height=c.height-C+"px"}}}function N(){s.forEach(o=>{const t=o.cy.png(),e=document.createElement("a");e.href=t,e.download=`${o.label}.png`,e.click()})}r.useEffect(()=>{const o=()=>n==null?void 0:n.disable(),t=()=>n==null?void 0:n.enable(),e=a.current;return e==null||e.addEventListener("mousedown",o),e==null||e.addEventListener("mouseup",t),n==null||n.getGridItems().forEach(y),()=>{e==null||e.removeEventListener("mousedown",o),e==null||e.removeEventListener("mouseup",t)}},[n]),r.useEffect(()=>{const o=[];for(let t=0;t<s.length;t++){const e=s[t];o.push(u.jsx("option",{value:e.label,children:e.label},e.label+"_"+t)),a.current&&t==0&&(e.cy.mount(a.current),e.cy.fit())}return E(o),()=>{for(const t of s)t.cy.unmount()}},[s]),r.useEffect(()=>{i&&fetch("/api/"+l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:i})}).then(o=>{if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return o.json()}).then(o=>{if(o.status==="error")throw new Error(o.message);return o}).then(o=>{const t=[];for(const e in o.graph){const c=R[e],m=g(c,o.graph[e]);t.push({cy:m,label:e})}w(t)}).catch(o=>{console.error("Error sending code to the server:",o)})},[i,l]),r.useEffect(()=>{const o=f.currentState[l+"Node"];for(const t of s){const e=t.cy;e.nodes().style({"background-color":"#BBB"});for(const c of f.prevMatchedNodes)e.nodes(`[id = "${c[l+"Node"]}"]`).style({"background-color":"#ff0000"});for(const c of f.matchedNodes)e.nodes(`[id = "${c[l+"Node"]}"]`).style({"background-color":"#008"});if(e.nodes(`[id = "${o}"]`).style({"background-color":"#080"}),h.current&&h.current.checked){const c=t.cy.animation({center:{eles:t.cy.nodes(`[id = "${o}"]`)},duration:200});c.play&&c.play()}}},[f,l,s,f.prevMatchedNodes,f.matchedNodes]);const j=o=>{for(const e of s)e.cy.unmount();const t=o.target.value;for(const e of s)a.current&&e.label===t&&(e.cy.mount(a.current),e.cy.fit())},k=()=>{for(const o of s)o.cy.fit()};return u.jsxs("div",{className:"vstack container-fluid",ref:d,children:[u.jsxs("div",{className:"input-group",ref:p,children:[u.jsxs("label",{className:"input-group-text",children:["Follow ",u.jsx("input",{type:"checkbox",className:"form-check-input",id:b,ref:h})]}),u.jsx("select",{className:"form-select",id:l+"-select",onChange:j,children:x}),u.jsx("button",{className:"btn btn-primary ms-auto",onClick:k,children:"Reset"}),u.jsx("button",{className:"btn btn-primary",onClick:N,children:"Download"})]}),u.jsx("div",{id:v,ref:a,className:"p-2"})]})};export{S as default};
